const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ArticleFormModal-CCbqnpyz.js","assets/markdown-vendor-C07DKSYQ.js","assets/react-vendor-D-XgqoRR.js","assets/LoadingSpinner-D5o6XWKR.js","assets/icons-vendor-CNZ2fQuB.js","assets/DirectoryFormModal-B-bbENpB.js","assets/AuthModal-CtFKpXji.js"])))=>i.map(i=>d[i]);
import{j as e,M as t,r,a}from"./markdown-vendor-C07DKSYQ.js";import{a as s,r as i,R as n}from"./react-vendor-D-XgqoRR.js";import{c as o}from"./supabase-vendor-BaswEe3z.js";import{A as l,X as d,P as c,F as g,a as m,C as x,b as u,c as h,d as y,e as b,f as p,T as f,g as j,M as v,G as k,L as w,K as N,S,h as D,i as C,j as _,k as A,l as I,U as E,B as F,E as L,m as T,n as O}from"./icons-vendor-CNZ2fQuB.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var z={},R=s;z.createRoot=R.createRoot,z.hydrateRoot=R.hydrateRoot;const M={},Z=function(e,t,r){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),r=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));a=Promise.allSettled(t.map(e=>{if((e=function(e){return"/myReact/"+e}(e))in M)return;M[e]=!0;const t=e.endsWith(".css"),a=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${a}`))return;const s=document.createElement("link");return s.rel=t?"stylesheet":"modulepreload",t||(s.as="script"),s.crossOrigin="",s.href=e,r&&s.setAttribute("nonce",r),document.head.appendChild(s),t?new Promise((t,r)=>{s.addEventListener("load",t),s.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function s(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&s(e.reason);return e().catch(s)})};let P=[{id:"1",name:"React 基础",parent_id:null,created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z",articles:[{id:"1",title:"React 简介",created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z"},{id:"2",title:"创建第一个组件",created_at:"2024-01-02T00:00:00Z",updated_at:"2024-01-02T00:00:00Z"}]},{id:"2",name:"React Hooks",parent_id:null,created_at:"2024-01-02T00:00:00Z",updated_at:"2024-01-02T00:00:00Z",articles:[{id:"3",title:"useState Hook",created_at:"2024-01-03T00:00:00Z",updated_at:"2024-01-03T00:00:00Z"}]},{id:"3",name:"高级概念",parent_id:null,created_at:"2024-01-03T00:00:00Z",updated_at:"2024-01-03T00:00:00Z",articles:[]}],H=[...[{id:"1",title:"React 简介",content:"# React 简介\n\nReact 是一个用于构建用户界面的 JavaScript 库，由 Facebook 开发并维护。它采用组件化的开发方式，让开发者能够构建可复用的 UI 组件。\n\n## 为什么选择 React？\n\n### 1. 组件化开发\nReact 将 UI 拆分成独立的、可复用的组件，每个组件都有自己的状态和逻辑。\n\n```jsx\nfunction Welcome(props) {\n  return <h1>Hello, {props.name}!</h1>;\n}\n```\n\n### 2. 虚拟 DOM\nReact 使用虚拟 DOM 来提高性能，只更新实际发生变化的部分。\n\n### 3. 单向数据流\n数据从父组件流向子组件，使应用的数据流更加可预测。\n\n### 4. 丰富的生态系统\nReact 拥有庞大的社区和丰富的第三方库。\n\n## 核心概念\n\n- **组件 (Components)**: UI 的基本构建块\n- **JSX**: JavaScript 的语法扩展\n- **Props**: 组件的属性\n- **State**: 组件的状态\n\n## 开始学习\n\n准备好开始你的 React 之旅了吗？让我们从创建第一个组件开始！",directory_id:"1",is_published:!0,created_at:"2024-01-01T00:00:00Z",updated_at:"2024-01-01T00:00:00Z",directories:{id:"1",name:"React 基础"}},{id:"2",title:"创建第一个组件",content:'# 创建第一个组件\n\n在 React 中，组件是构建用户界面的基本单位。让我们学习如何创建和使用组件。\n\n## 函数组件\n\n最简单的组件是函数组件：\n\n```jsx\nfunction Greeting() {\n  return <h1>Hello, World!</h1>;\n}\n```\n\n## 使用组件\n\n创建组件后，你可以像使用 HTML 标签一样使用它：\n\n```jsx\nfunction App() {\n  return (\n    <div>\n      <Greeting />\n      <Greeting />\n    </div>\n  );\n}\n```\n\n## 带参数的组件\n\n组件可以接收参数（称为 props）：\n\n```jsx\nfunction Greeting(props) {\n  return <h1>Hello, {props.name}!</h1>;\n}\n\nfunction App() {\n  return (\n    <div>\n      <Greeting name="Alice" />\n      <Greeting name="Bob" />\n    </div>\n  );\n}\n```\n\n## JSX 规则\n\n1. 必须返回单个根元素\n2. 使用 `className` 而不是 `class`\n3. 所有标签必须闭合\n4. 使用驼峰命名法\n\n```jsx\nfunction MyComponent() {\n  return (\n    <div className="container">\n      <img src="image.jpg" alt="Description" />\n      <input type="text" />\n    </div>\n  );\n}\n```',directory_id:"1",is_published:!0,created_at:"2024-01-02T00:00:00Z",updated_at:"2024-01-02T00:00:00Z",directories:{id:"1",name:"React 基础"}},{id:"3",title:"useState Hook",content:"# useState Hook\n\n`useState` 是 React 中最常用的 Hook，用于在函数组件中添加状态。\n\n## 基本用法\n\n```jsx\nimport { useState } from 'react';\n\nfunction Counter() {\n  const [count, setCount] = useState(0);\n\n  return (\n    <div>\n      <p>You clicked {count} times</p>\n      <button onClick={() => setCount(count + 1)}>\n        Click me\n      </button>\n    </div>\n  );\n}\n```\n\n## 状态更新\n\n### 直接设置新值\n```jsx\nconst [name, setName] = useState('');\nsetName('Alice');\n```\n\n### 基于前一个状态更新\n```jsx\nconst [count, setCount] = useState(0);\nsetCount(prevCount => prevCount + 1);\n```\n\n## 注意事项\n\n1. 状态更新是异步的\n2. 不要直接修改状态对象\n3. 使用函数式更新避免闭包问题",directory_id:"2",is_published:!0,created_at:"2024-01-03T00:00:00Z",updated_at:"2024-01-03T00:00:00Z",directories:{id:"2",name:"React Hooks"}}]];const q="https://vtslbeziohxlvmibthfp.supabase.co",J=q.includes("your-project-id");let B=null;if(!J)try{B=o(q,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ0c2xiZXppb2h4bHZtaWJ0aGZwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM4ODM4OTYsImV4cCI6MjA3OTQ1OTg5Nn0.S2NRwGzMNMC4e3JLdHTxkFYFHtyTq7Ja_vqptwJyGkM")}catch(xe){}function $(e,t){const r=e.map(e=>({...e,articles:t.filter(t=>t.directory_id===e.id)}));function a(e){const t=r.filter(t=>t.parent_id===e.id);return t.length>0&&(e.children=t.map(e=>a(e))),e}return r.filter(e=>!e.parent_id).map(e=>a(e))}const G={async getDirectoryTree(){if(J||!B)return new Promise(e=>{setTimeout(()=>{const t=$(P,H);e(t)},100)});try{const{data:e,error:t}=await B.from("directories").select("*").order("created_at");if(t)throw t;const{data:r,error:a}=await B.from("articles").select("id, title, directory_id, created_at, updated_at").eq("is_published",!0).order("created_at");if(a)throw a;return $(e,r)}catch(xe){return $(P,H)}},async getArticle(e){if(J||!B)return new Promise(t=>{setTimeout(()=>{const r=H.find(t=>t.id===e);t(r||null)},100)});try{const{data:t,error:r}=await B.from("articles").select("\n          *,\n          directories (\n            id,\n            name\n          )\n        ").eq("id",e).single();if(r)throw r;return t}catch(xe){return H.find(t=>t.id===e)||null}},async createDirectory(e){if(J||!B)return new Promise((t,r)=>{setTimeout(()=>{try{const r={id:Date.now().toString(),...e,parent_id:e.parent_id||null,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),articles:[]};P.push(r),t(r)}catch(xe){r(xe)}},100)});try{const{data:t,error:r}=await B.from("directories").insert(e).select().single();if(r)throw r;return t}catch(xe){const r={id:Date.now().toString(),...e,parent_id:e.parent_id||null,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),articles:[]};return P.push(r),r}},async updateDirectory(e,t){if(J||!B)return new Promise((r,a)=>{setTimeout(()=>{try{const s=P.findIndex(t=>t.id===e);if(s>-1){const a=P[s].parent_id,i=t.parent_id||null;if(P[s]={...P[s],...t,parent_id:i,updated_at:(new Date).toISOString()},a!==i){const t=e=>{H.forEach(t=>{t.directory_id===e&&(t.updated_at=(new Date).toISOString())});P.filter(t=>t.parent_id===e).forEach(e=>t(e.id))};t(e)}r(P[s])}else a(new Error("目录不存在"))}catch(xe){a(xe)}},100)});try{const{data:r,error:a}=await B.from("directories").update(t).eq("id",e).select().single();if(a)throw a;return r}catch(xe){const a=P.findIndex(t=>t.id===e);if(a>-1){const r=P[a].parent_id,s=t.parent_id||null;if(P[a]={...P[a],...t,parent_id:s,updated_at:(new Date).toISOString()},r!==s){const t=e=>{H.forEach(t=>{t.directory_id===e&&(t.updated_at=(new Date).toISOString())});P.filter(t=>t.parent_id===e).forEach(e=>t(e.id))};t(e)}return P[a]}throw xe}},async deleteDirectory(e){if(J||!B)return new Promise(t=>{setTimeout(()=>{const r=e=>{P.filter(t=>t.parent_id===e).forEach(e=>r(e.id));H.filter(t=>t.directory_id===e).forEach(e=>{const t=H.findIndex(t=>t.id===e.id);t>-1&&H.splice(t,1)});const t=P.findIndex(t=>t.id===e);t>-1&&P.splice(t,1)};r(e),t()},100)});try{const{error:t}=await B.from("directories").delete().eq("id",e);if(t)throw t}catch(xe){const r=e=>{P.filter(t=>t.parent_id===e).forEach(e=>r(e.id));H.filter(t=>t.directory_id===e).forEach(e=>{const t=H.findIndex(t=>t.id===e.id);t>-1&&H.splice(t,1)});const t=P.findIndex(t=>t.id===e);t>-1&&P.splice(t,1)};r(e)}},async createArticle(e){if(J||!B)return new Promise(t=>{setTimeout(()=>{const r={id:Date.now().toString(),...e,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),directories:P.find(t=>t.id===e.directory_id)||null};H.push(r),t(r)},100)});try{const{data:t,error:r}=await B.from("articles").insert(e).select().single();if(r)throw r;return t}catch(xe){const r={id:Date.now().toString(),...e,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString()};return H.push(r),r}},async updateArticle(e,t){if(J||!B)return new Promise(r=>{setTimeout(()=>{const a=H.findIndex(t=>t.id===e);a>-1&&(H[a]={...H[a],...t,updated_at:(new Date).toISOString()},r(H[a]))},100)});try{const{data:r,error:a}=await B.from("articles").update(t).eq("id",e).select().single();if(a)throw a;return r}catch(xe){const a=H.findIndex(t=>t.id===e);if(a>-1)return H[a]={...H[a],...t,updated_at:(new Date).toISOString()},H[a];throw xe}},async deleteArticle(e){if(J||!B)return new Promise(t=>{setTimeout(()=>{const r=H.findIndex(t=>t.id===e);r>-1&&H.splice(r,1),t()},100)});try{const{error:t}=await B.from("articles").delete().eq("id",e);if(t)throw t}catch(xe){const r=H.findIndex(t=>t.id===e);r>-1&&H.splice(r,1)}},async searchArticles(e){if(J||!B)return new Promise(t=>{setTimeout(()=>{let r=H.filter(e=>e.is_published);if(e&&e.trim()){const t=e.toLowerCase();r=r.filter(e=>e.title.toLowerCase().includes(t)||e.content.toLowerCase().includes(t))}t(r.sort((e,t)=>new Date(t.created_at)-new Date(e.created_at)))},100)});try{if(!e.trim()){const{data:e,error:t}=await B.from("articles").select("\n            *,\n            directories (\n              id,\n              name\n            )\n          ").eq("is_published",!0).order("created_at",{ascending:!1});if(t)throw t;return e}const{data:t,error:r}=await B.from("articles").select("\n          *,\n          directories (\n            id,\n            name\n          )\n        ").or(`title.ilike.%${e}%,content.ilike.%${e}%`).eq("is_published",!0).order("created_at",{ascending:!1});if(r)throw r;return t}catch(xe){return H.filter(e=>e.is_published)}}};function W({isOpen:t,onClose:r,onConfirm:a,title:s,message:i,confirmText:n="确认",cancelText:o="取消",type:c="danger"}){if(!t)return null;const g={danger:{icon:"text-red-600",button:"bg-red-600 hover:bg-red-700 focus:ring-red-500"},warning:{icon:"text-yellow-600",button:"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500"},info:{icon:"text-blue-600",button:"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500"}}[c];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-md w-full transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-full bg-gray-100 dark:bg-gray-700 ${g.icon}`,children:e.jsx(l,{size:20})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:s})]}),e.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx(d,{size:20})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:i}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:r,className:"px-4 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:ring-2 focus:ring-gray-500 dark:focus:ring-blue-500 focus:border-transparent transition-colors",children:o}),e.jsx("button",{onClick:()=>{a(),r()},className:`px-4 py-2 text-white rounded-md focus:ring-2 focus:border-transparent ${g.button}`,children:n})]})]})]})})}function U(){return e.jsxs("div",{className:"animate-pulse space-y-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 py-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-32"})]}),e.jsxs("div",{className:"ml-6 space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 py-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-40"})]}),e.jsxs("div",{className:"flex items-center space-x-2 py-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-36"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 py-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-28"})]}),e.jsxs("div",{className:"ml-6 space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 py-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-44"})]}),e.jsxs("div",{className:"flex items-center space-x-2 py-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"})]}),e.jsxs("div",{className:"flex items-center space-x-2 py-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-38"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 py-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-36"})]}),e.jsx("div",{className:"ml-6 space-y-2",children:e.jsxs("div",{className:"flex items-center space-x-2 py-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-40"})]})})]}),e.jsxs("div",{className:"flex items-center space-x-2 py-2",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-300 dark:bg-gray-600 rounded"}),e.jsx("div",{className:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-30"})]})]})}function V({onItemClick:t,onArticleSelect:r,collapsed:a,onToggleCollapse:s,onEditArticle:n,onCreateArticle:o,onEditDirectory:l,onCreateDirectory:d,directories:v=[],directoriesLoading:k=!1,onLoadDirectories:w,selectedArticle:N=null,isAuthenticated:S=!1}){const[D,C]=i.useState(new Set),[_,A]=i.useState(!1),[I,E]=i.useState({isOpen:!1,type:"danger",title:"",message:"",onConfirm:null});i.useEffect(()=>{if(v.length>0){const e=new Set,t=r=>{r.forEach(r=>{e.add(r.id),r.children&&r.children.length>0&&t(r.children)})};t(v),C(e)}},[v]);const F=(a,s=0)=>{const i=D.has(a.id),d=a.articles&&a.articles.length>0,c=a.children&&a.children.length>0,g=d||c;return e.jsxs("div",{className:"select-none",children:[e.jsxs("div",{className:"group flex items-center py-2 px-3 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",style:{paddingLeft:12+16*s+"px"},children:[e.jsxs("div",{className:"flex items-center flex-1 cursor-pointer",onClick:()=>g&&(e=>{const t=new Set(D);t.has(e)?t.delete(e):t.add(e),C(t)})(a.id),children:[g?e.jsxs(e.Fragment,{children:[i?e.jsx(x,{size:16,className:"text-gray-400 mr-1"}):e.jsx(u,{size:16,className:"text-gray-400 mr-1"}),i?e.jsx(h,{size:16,className:"text-gray-600 mr-2"}):e.jsx(y,{size:16,className:"text-gray-600 mr-2"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 mr-1"}),e.jsx(y,{size:16,className:"text-gray-600 mr-2"})]}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 truncate flex-1",title:a.name,children:a.name})]}),S&&e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 flex items-center space-x-1 ml-2",children:[e.jsx("button",{onClick:()=>l&&l(a),className:"p-1 hover:bg-gray-300 rounded text-gray-700 dark:text-gray-100 dark:hover:bg-gray-500",title:"编辑目录",children:e.jsx(b,{size:12})}),e.jsx("button",{onClick:()=>o&&o(a.id),className:"p-1 hover:bg-gray-300 rounded text-gray-700 dark:text-gray-100 dark:hover:bg-gray-500",title:"在此目录下新建文章",children:e.jsx(p,{size:14})}),e.jsx("button",{onClick:()=>{var e;E({isOpen:!0,type:"danger",title:"删除目录",message:`该操作会删除目录"${(e=a).name}"及其中全部文章，是否继续？`,onConfirm:async()=>{A(!0);try{await G.deleteDirectory(e.id),await w(!0),window.dispatchEvent(new CustomEvent("directoryDeleted",{detail:{directoryId:e.id}}))}catch(xe){alert("删除失败: "+xe.message)}finally{A(!1)}}})},className:"p-1 hover:bg-gray-300 hover:text-red-500 rounded text-gray-700 dark:text-gray-100 dark:hover:bg-gray-500 dark:hover:text-red-500",title:"删除目录",children:e.jsx(f,{size:12})})]})]}),i&&e.jsxs("div",{children:[d&&a.articles.map(a=>{const i=N&&N.id===a.id;return e.jsxs("div",{className:"group flex items-center py-2 px-3 ml-2 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors "+(i?"bg-blue-50 dark:bg-blue-900/30 border-l-2 border-blue-600":""),style:{paddingLeft:28+16*s+"px"},children:[e.jsxs("button",{onClick:()=>{r&&r(a.id),t&&t()},className:"flex-1 flex items-center text-left min-w-0 "+(i?"text-blue-600 dark:text-blue-400 font-medium":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"),title:a.title,children:[e.jsx(j,{size:14,className:"mr-2 flex-shrink-0 "+(i?"text-blue-600 dark:text-blue-400":"text-gray-400 dark:text-gray-500")}),e.jsx("span",{className:"text-sm truncate",children:a.title})]}),S&&e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 flex items-center space-x-1 ml-2 flex-shrink-0",children:[e.jsx("button",{onClick:()=>(async e=>{try{const t=await G.getArticle(e.id);n&&n(t)}catch(xe){alert("加载文章失败: "+xe.message)}})(a),className:"p-1 hover:bg-gray-300 rounded text-gray-700 dark:text-gray-100 dark:hover:bg-gray-500",title:"编辑文章",children:e.jsx(b,{size:12})}),e.jsx("button",{onClick:()=>{return e=a.id,t=a.title,void E({isOpen:!0,type:"danger",title:"删除文章",message:`是否要删除文章"${t}"？`,onConfirm:async()=>{A(!0);try{await G.deleteArticle(e),await w(!0),window.dispatchEvent(new CustomEvent("articleDeleted",{detail:{articleId:e}}))}catch(xe){alert("删除失败: "+xe.message)}finally{A(!1)}}});var e,t},className:"p-1 hover:bg-gray-300 hover:text-red-500 rounded text-gray-700 dark:text-gray-100 dark:hover:bg-gray-500 dark:hover:text-red-500",title:"删除文章",children:e.jsx(f,{size:12})})]})]},a.id)}),c&&a.children.map(e=>F(e,s+1))]})]},a.id)};return a?e.jsx("nav",{className:"border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 fixed left-0 top-16 z-20 w-12 transition-colors",style:{height:"calc(100vh - 4rem)"},children:e.jsx("div",{className:"p-2",children:e.jsx("button",{onClick:s,className:"w-8 h-8 flex items-center text-gray-900 dark:text-gray-100 justify-center hover:bg-gray-400 rounded",title:"展开目录",children:e.jsx(c,{size:16})})})}):e.jsxs(e.Fragment,{children:[e.jsxs("nav",{className:"border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 fixed left-0 top-16 z-20 w-80 flex flex-col transition-colors",style:{height:"calc(100vh - 4rem)"},children:[e.jsx("div",{className:"p-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 truncate",children:"文章目录"}),e.jsxs("div",{className:"flex items-center space-x-1",children:[S&&e.jsx("button",{onClick:()=>d&&d(),className:"p-1 hover:bg-gray-400 rounded text-gray-900 dark:text-gray-100 hover:text-gray-800",title:"新建目录",children:e.jsx(g,{size:16})}),e.jsx("button",{onClick:s,className:"p-1 hover:bg-gray-400 rounded text-gray-900 dark:text-gray-100",title:"收起目录",children:e.jsx(m,{size:16})})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-4 pb-4 custom-scrollbar",children:e.jsx("div",{className:"space-y-1",children:k?e.jsx(U,{}):0===v.length?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{children:"暂无目录"}),e.jsx("button",{onClick:()=>d&&d(),className:"mt-2 text-blue-600 hover:text-blue-700 text-sm",children:"创建第一个目录"})]}):v.map(e=>F(e))})})]}),e.jsx(W,{isOpen:I.isOpen,onClose:()=>E({...I,isOpen:!1}),onConfirm:I.onConfirm,title:I.title,message:I.message,type:I.type}),_&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 shadow-xl",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-gray-900 dark:border-gray-100"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 text-sm",children:"处理中..."})]})})})]})}function X({isMobile:t,onMenuClick:r,isDark:a,onToggleDarkMode:s,isAuthenticated:i,onAuthClick:n,onLogout:o,onLogoClick:l}){return e.jsx("header",{className:"bg-[#001529] dark:bg-gray-900 border-b border-gray-700 dark:border-gray-800 sticky top-0 z-30 transition-colors",children:e.jsx("div",{className:"px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[t&&e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-700 dark:hover:bg-gray-800 rounded-md text-white transition-colors",children:e.jsx(v,{size:20})}),e.jsxs("button",{onClick:l,className:"flex items-center space-x-2 hover:opacity-80 transition-opacity",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center",children:e.jsx("img",{src:"/myReact/assets/react-CC1bUvkJ.svg",alt:"logo",className:"mx-auto"})}),e.jsx("span",{className:"text-xl font-bold text-white",children:"React 日记"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("a",{href:"https://github.com/ziqingchuan",target:"_blank",rel:"noopener noreferrer",className:"p-2 hover:bg-gray-700 dark:hover:bg-gray-800 rounded-md text-white transition-colors",title:"访问 GitHub",children:e.jsx(k,{size:20})}),i?e.jsx("button",{onClick:o,className:"p-2 hover:bg-gray-700 dark:hover:bg-gray-800 rounded-md text-green-400 transition-colors",title:"退出编辑模式",children:e.jsx(w,{size:20})}):e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-700 dark:hover:bg-gray-800 rounded-md text-white transition-colors",title:"开启编辑权限",children:e.jsx(N,{size:20})}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-700 dark:hover:bg-gray-800 rounded-md text-white transition-colors",title:a?"切换到明亮模式":"切换到暗黑模式",children:a?e.jsx(S,{size:20}):e.jsx(D,{size:20})})]})]})})})}function Y({content:s}){const[n,o]=i.useState(null),l=e=>"string"==typeof e?e:Array.isArray(e)?e.map(l).join(""):e&&"object"==typeof e&&e.props&&e.props.children?l(e.props.children):"",d=e=>l(e).toLowerCase().replace(/[^\w\u4e00-\u9fff]+/g,"-").replace(/^-+|-+$/g,"")||"heading",c=e=>{if("string"==typeof e)return e;if(Array.isArray(e))return e.map(c).join("");if(e&&"object"==typeof e){if(e.props&&e.props.children)return c(e.props.children);if(e.children)return c(e.children)}return""},g={pre({children:t}){const r=null==t?void 0:t.props,a=(null==r?void 0:r.className)||"",s=/language-(\w+)/.exec(a);if(s){const a=c(null==r?void 0:r.children),i=(e=>{let t=0;for(let r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r),t&=t}return Math.abs(t).toString(36).substring(0,10)})(a.substring(0,100));return e.jsxs("div",{className:"relative group",children:[e.jsxs("div",{className:"flex items-center justify-between bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-200 px-4 py-2 text-sm rounded-t-lg border-b border-gray-300 dark:border-gray-700",children:[e.jsx("span",{className:"font-mono",children:s[1]}),e.jsx("button",{onClick:()=>(async(e,t)=>{try{await navigator.clipboard.writeText(e),o(t),setTimeout(()=>o(null),2e3)}catch(r){}})(a,i),className:"flex items-center space-x-1 hover:bg-gray-200 dark:hover:bg-gray-700 px-2 py-1 rounded transition-colors",children:n===i?e.jsxs(e.Fragment,{children:[e.jsx(C,{size:14}),e.jsx("span",{children:"已复制"})]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{size:14}),e.jsx("span",{children:"复制"})]})})]}),e.jsx("pre",{className:"!mt-0 !rounded-t-none overflow-x-auto bg-gray-50 dark:bg-gray-900",children:t})]})}return e.jsx("pre",{children:t})},code:({node:t,inline:r,className:a,children:s,...i})=>r?e.jsx("code",{className:"bg-gray-100 dark:bg-gray-800/50 text-pink-600 dark:text-emerald-400 px-1.5 py-0.5 rounded text-sm font-mono border border-transparent dark:border-gray-700/50",...i,children:s}):e.jsx("code",{className:a,...i,children:s}),h1({children:t}){const r=d(t);return e.jsx("h1",{id:r,className:"text-3xl font-bold text-gray-900 dark:text-gray-100 mb-6 mt-8 border-b border-gray-200 dark:border-gray-700 pb-2 scroll-mt-20",children:t})},h2({children:t}){const r=d(t);return e.jsx("h2",{id:r,className:"text-2xl font-semibold text-gray-900 dark:text-gray-100 mb-4 mt-6 scroll-mt-20",children:t})},h3({children:t}){const r=d(t);return e.jsx("h3",{id:r,className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-3 mt-5 scroll-mt-20",children:t})},p:({children:t})=>e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-7 mb-4",children:t}),ul:({children:t})=>e.jsx("ul",{className:"list-disc list-inside mb-4 space-y-2 text-gray-700 dark:text-gray-300",children:t}),ol:({children:t})=>e.jsx("ol",{className:"list-decimal list-inside mb-4 space-y-2 text-gray-700 dark:text-gray-300",children:t}),blockquote:({children:t})=>e.jsx("blockquote",{className:"border-l-4 border-primary-500 pl-4 italic text-gray-600 dark:text-gray-400 mb-4 bg-gray-50 dark:bg-gray-800 py-2",children:t}),table:({children:t})=>e.jsx("div",{className:"overflow-x-auto mb-4",children:e.jsx("table",{className:"w-full border-collapse border border-gray-300 dark:border-gray-600",children:t})}),th:({children:t})=>e.jsx("th",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 text-left bg-gray-50 dark:bg-gray-800 dark:text-gray-200 font-semibold",children:t}),td:({children:t})=>e.jsx("td",{className:"border border-gray-300 dark:border-gray-600 px-4 py-2 dark:text-gray-300",children:t}),a:({href:t,children:r})=>e.jsx("a",{href:t,className:"text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 underline",target:(null==t?void 0:t.startsWith("http"))?"_blank":void 0,rel:(null==t?void 0:t.startsWith("http"))?"noopener noreferrer":void 0,children:r})};return e.jsx("div",{className:"prose max-w-none",children:e.jsx(t,{remarkPlugins:[a],rehypePlugins:[r],components:g,children:s})})}function Q({article:t}){const r=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"});return t?e.jsxs("div",{className:"max-w-4xl mx-auto min-h-full",children:[e.jsxs("header",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:t.title}),t.description&&e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400 mb-6",children:t.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{size:16,className:"mr-1"}),e.jsxs("span",{children:["发布于 ",r(t.created_at)]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{size:16,className:"mr-1"}),e.jsxs("span",{children:["阅读时间 ",(e=>{const t=e.split(/\s+/).length;return Math.ceil(t/200)})(t.content)," 分钟"]})]})]})]}),e.jsx("article",{className:"prose max-w-none pb-8",children:e.jsx(Y,{content:t.content})}),e.jsxs("footer",{className:"mt-8 pt-8 pb-10 border-t border-gray-200 dark:border-gray-700 flex flex-col items-end gap-4",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(A,{size:14,className:"mr-2"}),e.jsxs("span",{children:["最后更新于: ",r(t.updated_at)]})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(E,{size:14,className:"mr-2"}),e.jsx("span",{children:"作者: Qingchuan Zi"})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100 mb-4",children:"文章不存在"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"请选择其他文章"})]})}function K({onReturnHome:t}){return e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx("img",{src:"/myReact/assets/notfound-BvOBckcb.svg",alt:"文章未找到",className:"w-64 h-64 mx-auto"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"糟糕，该文章不见了"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"您正在查看的文章已被删除或移动"}),e.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-900 text-white rounded-md hover:bg-gray-800",children:"返回首页"})]})}function ee({onArticleSelect:t}){const[r,a]=i.useState(!1);i.useEffect(()=>{a(!0)},[]);return e.jsx("div",{className:"min-h-[calc(100vh-8rem)] px-4 py-4 overflow-hidden flex items-center justify-center",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row items-center justify-between gap-12 mb-24 transition-all duration-1000 "+(r?"opacity-100 translate-y-0":"opacity-0 translate-y-10"),children:[e.jsxs("div",{className:"flex-1 text-center lg:text-left",children:[e.jsx("h1",{className:"text-gray-900 dark:text-white text-4xl md:text-5xl font-bold mb-6",children:"React"}),e.jsx("h2",{className:"text-gray-800 dark:text-gray-200 text-2xl md:text-2xl font-semibold mb-6",children:"用于构建用户界面的 JavaScript 库"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-lg mb-8 max-w-xl",children:"从左侧目录选择文章开始学习 React 的核心概念、最佳实践和高级特性"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center lg:justify-start",children:[e.jsxs("button",{onClick:()=>{t&&t("16754dea-2ebd-45c8-a8ec-a7516796f5ab")},className:"px-8 py-3 bg-[#001529] dark:bg-gray-800 border-2 dark:border-gray-600 border-gray-300 hover:border-blue-800 dark:hover:border-blue-500 text-white dark:text-gray-300 dark:hover:text-blue-400 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2 shadow-sm hover:shadow-md",children:[e.jsx(F,{className:"w-5 h-5"}),"开始学习"]}),e.jsxs("a",{href:"https://react.dev",target:"_blank",rel:"noopener noreferrer",className:"px-8 py-3 bg-white dark:bg-gray-800 border-2 border-gray-300 dark:border-gray-600 hover:border-blue-500 dark:hover:border-blue-500 text-gray-700 dark:text-gray-300 hover:text-blue-600 dark:hover:text-blue-400 rounded-lg font-medium transition-all duration-200 flex items-center justify-center gap-2",children:["官方文档",e.jsx(L,{className:"w-4 h-4"})]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-64 h-64 md:w-60 md:h-60 flex items-center justify-center",children:e.jsx("img",{src:"/myReact/assets/welcome-logo-Bm9mHSTt.svg",alt:"React Logo",className:"w-full h-full animate-spin-slow opacity-90"})})})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:[{title:"声明式编程",description:"按状态设计视图，数据变动时高效更新渲染组件",color:"bg-blue-500"},{title:"组件化开发",description:"封装组件并组合，通过JavaScript传递管理数据",color:"bg-purple-500"},{title:"一次学习，随处编写",description:"兼容现有技术栈，支持服务端渲染和原生开发",color:"bg-green-500"},{title:"Hooks 特性",description:"无需类组件即可使用state，支持自定义Hook",color:"bg-orange-500"},{title:"虚拟 DOM",description:"最小化真实DOM交互，计算最小变更提升性能",color:"bg-cyan-500"},{title:"丰富的生态系统",description:"社区庞大，拥有各类成熟的第三方解决方案",color:"bg-pink-500"}].map((t,a)=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 border border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 hover:shadow-md transition-all duration-300 "+(r?"opacity-100 translate-y-0":"opacity-0 translate-y-10"),style:{transitionDelay:60*(a+1)+"ms"},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${t.color}`}),e.jsx("h3",{className:"text-gray-900 dark:text-white text-lg font-semibold",children:t.title})]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm leading-relaxed",children:t.description})]},a))})]})})}function te(){return e.jsxs("div",{className:"max-w-4xl mx-auto animate-pulse",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"h-10 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-4"}),e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mb-6"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-32"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-24"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6"})]}),e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-2/3 mt-8"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-4/5"})]}),e.jsx("div",{className:"h-32 bg-gray-200 dark:bg-gray-700 rounded mt-6"}),e.jsxs("div",{className:"space-y-2 mt-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"})]}),e.jsx("div",{className:"h-8 bg-gray-200 dark:bg-gray-700 rounded w-1/2 mt-8"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6"})]}),e.jsxs("div",{className:"space-y-2 mt-6",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-11/12"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-10/12"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-11/12"})]})]})]})}function re({loading:t,articleLoading:r,articleNotFound:a,selectedArticle:s,onReturnHome:i,onArticleSelect:n}){return e.jsx("main",{className:"flex-1 min-w-0 overflow-auto h-screen bg-white dark:bg-gray-900 transition-colors custom-scrollbar",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-8 pb-16",children:t||r?e.jsx(te,{}):a?e.jsx(K,{onReturnHome:i}):s?e.jsx(Q,{article:s}):e.jsx(ee,{onArticleSelect:n})})})}function ae({isOpen:t,onClose:r,onArticleSelect:a,directories:s,directoriesLoading:i,onLoadDirectories:n,selectedArticle:o}){return t?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:r}),e.jsxs("div",{className:"fixed left-0 top-0 h-full w-80 bg-white shadow-lg z-50 transform transition-transform duration-300",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b dark:bg-gray-900",children:[e.jsx("h2",{className:"text-lg font-semibold dark:text-gray-100",children:"目录"}),e.jsx("button",{onClick:r,className:"p-1 hover:bg-gray-100 rounded dark:text-gray-100",children:e.jsx(d,{size:20})})]}),e.jsx(V,{onArticleSelect:a,onItemClick:r,directories:s,directoriesLoading:i,onLoadDirectories:n,selectedArticle:o})]})]}):null}function se({content:t,collapsed:r,onToggleCollapse:a}){const[s,n]=i.useState([]),[o,l]=i.useState(""),d=i.useRef(null),c=i.useRef(!1),g=i.useRef(null),m=i.useRef(null),x=e=>e.toLowerCase().replace(/[^\w\u4e00-\u9fff]+/g,"-").replace(/^-+|-+$/g,"")||"heading";i.useEffect(()=>{if(!t)return void n([]);const e=/^(#{1,3})\s+(.+)$/gm,r=[];let a;for(;null!==(a=e.exec(t));){const e=a[1].length,t=a[2].trim(),s=x(t);r.push({id:s,text:t,level:e})}n(r)},[t]),i.useEffect(()=>{if(0===s.length||r)return;const e=setTimeout(()=>{const e=document.querySelector("main");if(!e)return;(()=>{if(!document.querySelector("main"))return;const e=s.map(e=>document.getElementById(e.id)).filter(Boolean);if(0===e.length)return;let t=e[0];for(const r of e){if(!(r.getBoundingClientRect().top<=100))break;t=r}l(t.id)})();const t=new IntersectionObserver(e=>{if(c.current)return;const t=e.filter(e=>e.isIntersecting).sort((e,t)=>e.boundingClientRect.top-t.boundingClientRect.top);if(t.length>0){const e=t[0];l(e.target.id)}},{root:e,rootMargin:"-10% 0% -80% 0%",threshold:[0,.25,.5,.75,1]});d.current=t,s.forEach(e=>{const r=document.getElementById(e.id);r&&t.observe(r)})},50);return()=>{clearTimeout(e),d.current&&d.current.disconnect()}},[s,r]),i.useEffect(()=>{o&&!r&&g.current&&m.current&&requestAnimationFrame(()=>{if(!m.current||!g.current)return;const e=g.current,t=m.current,r=e.getBoundingClientRect(),a=t.getBoundingClientRect(),s=a.top-r.top+e.scrollTop,i=s+a.height,n=e.scrollTop,o=e.clientHeight;s<n?e.scrollTo({top:s-20,behavior:"smooth"}):i>n+o&&e.scrollTo({top:i-o+20,behavior:"smooth"})})},[o,r]);return r?e.jsx("div",{className:"fixed right-0 top-16 z-20 w-12 border-l border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 transition-colors",style:{height:"calc(100vh - 4rem)"},children:e.jsx("div",{className:"p-2",children:e.jsx("button",{onClick:a,className:"w-8 h-8 flex items-center text-gray-900 dark:text-gray-100 justify-center hover:bg-gray-400 rounded",title:"展开目录",children:e.jsx(T,{size:16})})})}):e.jsxs("div",{className:"fixed right-0 top-16 z-20 w-80 border-l border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 transition-colors flex flex-col",style:{height:"calc(100vh - 4rem)"},children:[e.jsx("div",{className:"p-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:"标题目录"}),e.jsx("button",{onClick:a,className:"p-1 hover:bg-gray-400 rounded text-gray-600 dark:text-gray-100",title:"收起目录",children:e.jsx(O,{size:16})})]})}),e.jsx("div",{ref:g,className:"flex-1 overflow-y-auto px-4 pb-4 custom-scrollbar",children:0===s.length?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400 text-sm",children:e.jsx("p",{children:"当前文章无标题"})}):e.jsx("div",{className:"space-y-1",children:s.map(t=>{const r=o===t.id,a=16*(t.level-1)+12;return e.jsx("button",{ref:r?m:null,onClick:()=>(e=>{const t=document.getElementById(e);if(t){l(e),c.current=!0;const r=document.querySelector("main");if(r){const e=t.offsetTop,a=80;r.scrollTo({top:e-a,behavior:"smooth"}),setTimeout(()=>{c.current=!1},1e3)}else t.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>{c.current=!1},1e3)}})(t.id),className:`\n          w-full text-left py-2 px-3 text-sm transition-colors duration-200\n          hover:bg-gray-50 dark:hover:bg-gray-700 hover:text-gray-900 dark:hover:text-gray-100\n          ${r?"text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 border-r-2 border-blue-600":"text-gray-600 dark:text-gray-400"}\n        `,style:{paddingLeft:`${a}px`},title:t.text,children:e.jsx("span",{className:"truncate block",children:t.text})},t.id)})})})]})}const ie="directories_cache",ne="directories_cache_time";function oe(){const[e,t]=i.useState(!1),[r,a]=i.useState(!1),[s,n]=i.useState(!1),[o,l]=i.useState(!1),[d,c]=i.useState(!0),[g,m]=i.useState(!1),[x,u]=i.useState(!1),[h,y]=i.useState(!1),[b,p]=i.useState(!0),[f,j]=i.useState(null),[v,k]=i.useState([]),[w,N]=i.useState(null),[S,D]=i.useState(!1),[C,_]=i.useState(!1),[A,I]=i.useState(null),[E,F]=i.useState({title:"",content:"",directory_id:"",is_published:!0}),[L,T]=i.useState({name:"",parent_id:""}),O=i.useRef(!1);i.useEffect(()=>{const e=()=>{a(window.innerWidth<768),window.innerWidth>=768&&t(!1)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),i.useEffect(()=>{(async()=>{R(!0);const e=localStorage.getItem("lastArticleId");if(e){m(!0),u(!1);try{const t=await G.getArticle(e);j(t)}catch(xe){localStorage.removeItem("lastArticleId")}finally{m(!1),c(!1)}}else c(!1)})()},[]),i.useEffect(()=>{const e=e=>{const{articleId:t}=e.detail;j(e=>e&&e.id===t?(u(!0),localStorage.removeItem("lastArticleId"),null):e),z()},t=e=>{const{directoryId:t}=e.detail;j(e=>e&&e.directory_id===t?(u(!0),localStorage.removeItem("lastArticleId"),null):e),z()};return window.addEventListener("articleDeleted",e),window.addEventListener("directoryDeleted",t),()=>{window.removeEventListener("articleDeleted",e),window.removeEventListener("directoryDeleted",t)}},[]);const z=i.useCallback(()=>{try{localStorage.removeItem(ie),localStorage.removeItem(ne)}catch(xe){}},[]),R=i.useCallback(async(e=!1,t=!1)=>{if(t||!O.current){if(!t){const e=(()=>{try{const e=localStorage.getItem(ie),t=localStorage.getItem(ne);if(e&&t){if(Date.now()-parseInt(t,10)<12e4)return JSON.parse(e)}}catch(xe){}return null})();if(e)return k(e),void p(!1)}O.current=!0,e&&p(!0);try{const e=await G.getDirectoryTree();k(e),(e=>{try{localStorage.setItem(ie,JSON.stringify(e)),localStorage.setItem(ne,Date.now().toString())}catch(xe){}})(e)}catch(xe){}finally{p(!1),O.current=!1}}},[]),M=(e,t=0)=>{let r=[];return e.forEach(e=>{const a="　".repeat(t);r.push({value:e.id,label:a+e.name}),e.children&&e.children.length>0&&(r=r.concat(M(e.children,t+1)))}),r};return{sidebarOpen:e,setSidebarOpen:t,isMobile:r,sidebarCollapsed:s,setSidebarCollapsed:n,tocCollapsed:o,setTocCollapsed:l,loading:d,articleLoading:g,articleNotFound:x,setArticleNotFound:u,formLoading:h,setFormLoading:y,directoriesLoading:b,selectedArticle:f,setSelectedArticle:j,directories:v,editingArticle:w,setEditingArticle:N,showCreateForm:S,setShowCreateForm:D,showCreateDirForm:C,setShowCreateDirForm:_,editingDirectory:A,setEditingDirectory:I,formData:E,setFormData:F,dirFormData:L,setDirFormData:T,loadDirectories:R,loadFirstArticle:async()=>{m(!0);try{const e=await G.searchArticles("");e&&e.length>0&&j(e[0])}catch(xe){}finally{c(!1),m(!1)}},handleArticleSelect:async e=>{m(!0),u(!1);try{const a=await G.getArticle(e);j(a),localStorage.setItem("lastArticleId",e),r&&t(!1)}catch(xe){u(!0),localStorage.removeItem("lastArticleId")}finally{m(!1),c(!1)}},getDirectoryOptions:M,invalidateCache:z}}const le="admin_authenticated";const de=i.lazy(()=>Z(()=>import("./ArticleFormModal-CCbqnpyz.js"),__vite__mapDeps([0,1,2,3,4]))),ce=i.lazy(()=>Z(()=>import("./DirectoryFormModal-B-bbENpB.js"),__vite__mapDeps([5,1,2,3,4]))),ge=i.lazy(()=>Z(()=>import("./AuthModal-CtFKpXji.js"),__vite__mapDeps([6,1,2,4])));function me(){const t=oe(),{isDark:r,toggleDarkMode:a}=function(){const[e,t]=i.useState(()=>{const e=localStorage.getItem("darkMode");return null!==e?"true"===e:window.matchMedia("(prefers-color-scheme: dark)").matches});return i.useEffect(()=>{e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("darkMode",e)},[e]),{isDark:e,toggleDarkMode:()=>{t(e=>!e)}}}(),{isAuthenticated:s,login:n,logout:o}=function(){const[e,t]=i.useState(!1);return i.useEffect(()=>{const e=localStorage.getItem(le);t("true"===e)},[]),{isAuthenticated:e,login:e=>"zqc040521"===e&&(localStorage.setItem(le,"true"),t(!0),!0),logout:()=>{localStorage.removeItem(le),t(!1)}}}(),[l,d]=i.useState(!1),c=function({setFormLoading:e,loadDirectories:t,setFormData:r,setEditingArticle:a,setShowCreateForm:s,invalidateCache:i,handleArticleSelect:n}){const o=()=>{r({title:"",content:"",directory_id:"",is_published:!0}),a(null),s(!1)};return{handleEditArticle:e=>{a(e),r({title:e.title,content:e.content,directory_id:e.directory_id||"",is_published:e.is_published}),s(!0)},handleSubmitArticle:async(r,a,s)=>{r.preventDefault(),e(!0);try{let e;s?(await G.updateArticle(s.id,a),e=s.id):e=(await G.createArticle(a)).id,o(),i(),await t(!0,!0),e&&await n(e)}catch(xe){alert("保存失败: "+xe.message)}finally{e(!1)}},resetForm:o}}({setFormLoading:t.setFormLoading,loadDirectories:t.loadDirectories,setFormData:t.setFormData,setEditingArticle:t.setEditingArticle,setShowCreateForm:t.setShowCreateForm,invalidateCache:t.invalidateCache,handleArticleSelect:t.handleArticleSelect}),g=function({setFormLoading:e,loadDirectories:t,setDirFormData:r,setEditingDirectory:a,setShowCreateDirForm:s,invalidateCache:i}){const n=()=>{r({name:"",parent_id:""}),a(null),s(!1)};return{handleCreateDirectory:()=>{a(null),r({name:"",parent_id:""}),s(!0)},handleEditDirectory:e=>{a(e),r({name:e.name,parent_id:e.parent_id||""}),s(!0)},handleSubmitDirectory:async(r,a,s)=>{if(r.preventDefault(),a.name.trim()){e(!0);try{const e={name:a.name.trim(),parent_id:a.parent_id||null};s?await G.updateDirectory(s.id,e):await G.createDirectory(e),n(),i(),await t(!0,!0)}catch(xe){alert("保存目录失败: "+xe.message)}finally{e(!1)}}else alert("请输入目录名称")},resetDirForm:n}}({setFormLoading:t.setFormLoading,loadDirectories:t.loadDirectories,setDirFormData:t.setDirFormData,setEditingDirectory:t.setEditingDirectory,setShowCreateDirForm:t.setShowCreateDirForm,invalidateCache:t.invalidateCache});return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900 transition-colors",children:[e.jsx(X,{isMobile:t.isMobile,onMenuClick:()=>t.setSidebarOpen(!0),isDark:r,onToggleDarkMode:a,isAuthenticated:s,onAuthClick:()=>d(!0),onLogout:o,onLogoClick:()=>{t.setSelectedArticle(null),t.setArticleNotFound(!1),localStorage.removeItem("lastArticleId")}}),e.jsxs("div",{className:"flex relative",children:[!t.isMobile&&e.jsx("div",{className:(t.sidebarCollapsed?"w-12":"w-80")+" flex-shrink-0",children:e.jsx(V,{onArticleSelect:t.handleArticleSelect,collapsed:t.sidebarCollapsed,onToggleCollapse:()=>t.setSidebarCollapsed(!t.sidebarCollapsed),onEditArticle:c.handleEditArticle,onCreateArticle:e=>{t.setFormData({...t.formData,directory_id:e}),t.setShowCreateForm(!0)},onEditDirectory:g.handleEditDirectory,onCreateDirectory:g.handleCreateDirectory,directories:t.directories,directoriesLoading:t.directoriesLoading,onLoadDirectories:t.loadDirectories,selectedArticle:t.selectedArticle,isAuthenticated:s})}),e.jsx(ae,{isOpen:t.sidebarOpen,onClose:()=>t.setSidebarOpen(!1),onArticleSelect:t.handleArticleSelect,directories:t.directories,directoriesLoading:t.directoriesLoading,onLoadDirectories:t.loadDirectories,selectedArticle:t.selectedArticle}),e.jsx(re,{loading:t.loading,articleLoading:t.articleLoading,articleNotFound:t.articleNotFound,selectedArticle:t.selectedArticle,onReturnHome:()=>{t.setArticleNotFound(!1),t.loadFirstArticle()},onArticleSelect:t.handleArticleSelect}),!t.isMobile&&t.selectedArticle&&!t.articleNotFound&&e.jsx("div",{className:(t.tocCollapsed?"w-12":"w-64")+" flex-shrink-0",children:e.jsx(se,{content:t.selectedArticle.content,collapsed:t.tocCollapsed,onToggleCollapse:()=>t.setTocCollapsed(!t.tocCollapsed)})}),e.jsx(i.Suspense,{fallback:null,children:e.jsx(de,{isOpen:t.showCreateForm,editingArticle:t.editingArticle,formData:t.formData,directories:t.directories,formLoading:t.formLoading,onClose:c.resetForm,onSubmit:e=>c.handleSubmitArticle(e,t.formData,t.editingArticle),onFormDataChange:t.setFormData,getDirectoryOptions:t.getDirectoryOptions})}),e.jsx(i.Suspense,{fallback:null,children:e.jsx(ce,{isOpen:t.showCreateDirForm,editingDirectory:t.editingDirectory,dirFormData:t.dirFormData,directories:t.directories,formLoading:t.formLoading,onClose:g.resetDirForm,onSubmit:e=>g.handleSubmitDirectory(e,t.dirFormData,t.editingDirectory),onFormDataChange:t.setDirFormData,getDirectoryOptions:t.getDirectoryOptions})}),e.jsx(i.Suspense,{fallback:null,children:e.jsx(ge,{isOpen:l,onClose:()=>d(!1),onSubmit:n})})]})]})}z.createRoot(document.getElementById("root")).render(e.jsx(n.StrictMode,{children:e.jsx(me,{})}));
